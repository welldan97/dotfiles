#!/usr/bin/env bash

set -e

# shellcheck disable=SC1090

main() {
  if [ -z "$DOTFILES_PATH" ]; then
    echo 'Please provide DOTFILES_PATH'
    exit 1
  fi

  while getopts ":dv" opt; do
    case $opt in
      d)
        dotfiles=true
        ;;
      v)
        verbose=true
        ;;
      \?)
        echo "Invalid option: -$OPTARG" >&2
        ;;
    esac
  done

  if [ "$verbose" = true ]; then
    set -x
  fi

  if [ ! "$dotfiles" = true ]; then
    source "$DOTFILES_PATH/configuration/scripts/configure-machine"
  fi

  install-dotfiles
}

install-dotfiles() {
  "$DOTFILES_PATH/scripts/install-dotfiles"
}

main "$@"
